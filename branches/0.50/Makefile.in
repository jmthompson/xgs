#
# Makefile for XGS
# Patched for FreeBSD by
# Joel Sutton, 17th April 1997

@SET_MAKE@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@


INCFLAGS 	= -I. -Iinclude -I$(srcdir) -I$(srcdir)/include
XGS_DIR		= @datadir@/xgs
DEFS 		= @DEFS@ -DXGS_DIR=\"$(XGS_DIR)\"
CC 		= @CC@
CFLAGS 		= @CFLAGS@
X_CFLAGS 	= @X_CFLAGS@
ALL_CFLAGS 	= $(INCFLAGS) $(DEFS) $(X_CFLAGS) $(CFLAGS)
CPP 		= @CPP@
SED 		= sed
LIBS		= @LIBS@ @X_PRE_LIBS@ -lXext -lX11 @X_EXTRA_LIBS@
LDFLAGS		= @X_LIBS@ @LDFLAGS@

XGS_SRCS	= adb.c adb-drv.c clock.c cpu.c debugger.c disks.c     \
		  dispatch.c emul.c hires.c iwm.c lores.c main.c       \
		  memory.c opcodes1.c opcodes2.c opcodes3.c opcodes4.c \
		  opcodes5.c rw.c smtport.c sound.c snd-drv.c super.c  \
		  table.c text.c video.c vid-drv.c

XGS_OBJS	= $(XGS_SRCS:.c=.o)

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

XGS_TARGET	= xgs
UTIL_TARGET	= imgconv imgutil

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@/xgs
sysconfdir	= @sysconfdir@

%.o: %.c
	$(CC) -c $(CPPFLAGS) $(ALL_CFLAGS) $<

%.s: %.c
	$(CC) -S $(CPPFLAGS) $(ALL_CFLAGS) $<

all: $(XGS_TARGET) $(UTIL_TARGET)

install: all
	-/bin/mkdir $(bindir)
	rm -f $(bindir)/$(XGS_TARGET)
	$(INSTALL_PROGRAM) $(XGS_TARGET) $(bindir)/$(XGS_TARGET)
	-/bin/mkdir $(XGS_DIR)
	$(INSTALL_DATA) $(srcdir)/xgs40.fnt $(XGS_DIR)/xgs40.fnt
	$(INSTALL_DATA) $(srcdir)/xgs80.fnt $(XGS_DIR)/xgs80.fnt
	for f in $(UTIL_TARGET) ; do \
		rm -f $(bindir)/$$f ; \
		$(INSTALL_PROGRAM) $$f $(bindir)/$$f ; \
	done

utils: $(UTIL_TARGET)

depend:
	rm -f .depend
	$(CC) -MM $(CPPFLAGS) $(ALL_CFLAGS) $(XGS_SRCS) > .depend

$(XGS_TARGET): $(XGS_OBJS)
	$(CC) -o $(XGS_TARGET) $(XGS_OBJS) $(LDFLAGS) $(LIBS)

imgconv: imgconv.o disks.o
	$(CC) -o imgconv imgconv.o disks.o $(LDFLAGS) $(LIBS)

imgutil: imgutil.o disks.o
	$(CC) -o imgutil imgutil.o disks.o $(LDFLAGS) $(LIBS)

distclean: clean
	rm -f Makefile config.log config.status config.cache include/config.h .depend
	rm -f adb-drv.c adb-drv.h main.c main.h snd-drv.c snd-drv.h vid-drv.c vid-drv.h

clean:
	rm -f $(XGS_TARGET) $(UTIL_TARGET) *.o *~ #*#

.c:
	$(CC) -o $@ $(CPPFLAGS) $(ALL_CFLAGS) $< $(LDFLAGS) $(LIBS)

opcodes1.c opcodes2.c opcodes3.c opcodes4.c opcodes5.c: include/opcodes.h

Makefile:: Makefile.in config.status
	$(SHELL) config.status

# the following lines only work with GNU make
ifeq (.depend,$(wildcard .depend))
include .depend
endif
